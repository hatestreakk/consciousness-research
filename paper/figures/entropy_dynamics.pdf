import matplotlib.pyplot as plt
import numpy as np

# Параметры из теории
alpha, beta, S_max, S_0 = 0.47, 0.32, 8.3, 1.2

# Симуляция динамики энтропии
np.random.seed(42)
t = np.linspace(0, 100, 500)
S = np.zeros_like(t)
S[0] = S_0

dt = t[1] - t[0]
for i in range(1, len(t)):
    # Периодические возмущения + случайные всплески
    I_d = 0.1 + 0.3 * np.sin(2*np.pi*t[i]/25) 
    if np.random.random() < 0.02:  # Случайные всплески
        I_d += 0.4 * np.random.random()
    
    I_d = min(max(I_d, 0), 1)  # Ограничение [0,1]
    
    # Динамика энтропии
    dS_dt = alpha * I_d * (1 - S[i-1]/S_max) - beta * (S[i-1] - S_0)
    noise = 0.15 * np.random.normal(0, 0.08)
    S[i] = S[i-1] + (dS_dt + noise) * dt
    S[i] = max(0.5, min(S[i], S_max + 0.5))

fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))

# График энтропии
ax1.plot(t, S, 'b-', linewidth=2, label='Psychological Entropy S(t)')
ax1.axhline(y=S_0, color='r', linestyle='--', alpha=0.8, 
           label=f'Baseline S₀ = {S_0}')
ax1.axhline(y=S_max, color='g', linestyle='--', alpha=0.8,
           label=f'Maximum S_max = {S_max}')
ax1.fill_between(t, S_0-0.5, S_0+0.5, alpha=0.2, color='green',
                label='Stable Consciousness Region')

ax1.set_ylabel('Psychological Entropy', fontsize=12)
ax1.set_title('Entropy Dynamics in Conscious Systems', fontsize=14, fontweight='bold')
ax1.legend()
ax1.grid(True, alpha=0.3)
ax1.set_ylim(0, 10)

# График возмущений
I_d_plot = 0.1 + 0.3 * np.sin(2*np.pi*t/25)
spikes = np.random.random(len(t)) < 0.02
I_d_plot[spikes] += 0.4 * np.random.random(sum(spikes))
I_d_plot = np.minimum(I_d_plot, 1.0)

ax2.plot(t, I_d_plot, 'r-', linewidth=2, label='Disruption Intensity I_d(t)')
ax2.set_xlabel('Time', fontsize=12)
ax2.set_ylabel('Disruption Intensity', fontsize=12)
ax2.set_ylim(0, 1)
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('paper/figures/entropy_dynamics.pdf', bbox_inches='tight', dpi=300)
plt.close()
